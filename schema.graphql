type Liqiudation @entity(immutable: true) {
  id: Bytes!
  user: Bytes! # address
  asset: Bytes! # address
  collateral_amount: BigInt! # uint256
  bitu_amount: BigInt! # uint256
  collateral_ratio: BigInt! # uint256
  timestamp: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Mint @entity(immutable: true) {
  id: Bytes!
  minter: Bytes! # address
  collateral_asset: Bytes! # address
  collateral_amount: BigInt! # uint256
  bitu_amount: BigInt! # uint256
  collateral_ratio: BigInt! # uint256
  timestamp: BigInt! # uint256
  mintfee: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Redeem @entity(immutable: true) {
  id: Bytes!
  redeemer: Bytes! # address
  collateral_asset: Bytes! # address
  collateral_amount: BigInt! # uint256
  bitu_amount: BigInt! # uint256
  collateral_ratio: BigInt! # uint256
  interest: BigInt! # uint256
  timestamp: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type CollateralAsset @entity {
  # asset token address
  id: ID!

  # mirrored from the smart contract
  symbol: String!
  name: String!
  decimals: BigInt!

  # token
  totalValueLocked: BigDecimal!
  totalValueLockedUSD: BigDecimal!

  bituMinted: BigDecimal!
  bituBurned: BigDecimal!

  liquidated: BigDecimal!
  liquidatedUSD: BigDecimal!

  fees: BigDecimal!
  feesUSD: BigDecimal!

  collateralRatio: BigDecimal!

  # User count
  userCount: BigInt!

  hourData: [CollateralAssetHourData!]! @derivedFrom(field: "collateralAsset")
}

type CollateralAssetHourData @entity {
  # timestamp / 3600
  id: ID!

  tokenAddress: ID!
  
  # date - hour start timestamp
  date: Int!

  collateralAsset: CollateralAsset!
}

type UserCollateralAsset @entity {
  # `user:token`
  id: ID!

  tokenAddress: ID!
  # mirrored from the smart contract
  symbol: String!
  name: String!
  decimals: BigInt!

  # collateral
  totalValueLocked: BigDecimal!
  totalValueLockedUSD: BigDecimal!

  bituMinted: BigDecimal!
  bituBurned: BigDecimal!

  liquidated: BigDecimal!
  liquidatedUSD: BigDecimal!

  fees: BigDecimal!
  feesUSD: BigDecimal!

  collateralRatio: BigDecimal!

  # User count
  user: User!
}

type User @entity {
  # Address
  id: ID!

  collateralAssets: [UserCollateralAsset!]! @derivedFrom(field: "user")
}
